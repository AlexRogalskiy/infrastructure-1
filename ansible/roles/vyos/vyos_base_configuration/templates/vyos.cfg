set interfaces ethernet eth1 address dhcp
set interfaces ethernet eth1 description 'WAN'
set interfaces ethernet eth1 hw-id '00:50:56:a7:5e:6f'

set interfaces ethernet eth0 description 'LAN'

set nat source rule 100 outbound-interface 'eth1'
set nat source rule 100 source address '10.0.0.1/24'
set nat source rule 100 translation address masquerade

set service dhcp-server disabled 'false'
set service dhcp-server dynamic-dns-update enable true
set service dhcp-server global-parameters 'zone dhcp.home.dmarby.se. { primary 127.0.0.1; }'
set service dhcp-server global-parameters 'zone 0.0.10.in-addr.arpa { primary 127.0.0.1; }'
set service dhcp-server global-parameters 'ddns-domainname &quot;dhcp.home.dmarby.se.&quot;;'
set service dhcp-server global-parameters 'ddns-rev-domainname &quot;in-addr.arpa.&quot;;'
set service dhcp-server global-parameters 'update-static-leases on;'
set service dhcp-server global-parameters 'update-conflict-detection false;'
set service dhcp-server global-parameters 'update-optimization false;'

set service dhcp-server shared-network-name LAN authoritative enable
set service dhcp-server shared-network-name LAN subnet 10.0.0.0/24 default-router '10.0.0.1'
set service dhcp-server shared-network-name LAN subnet 10.0.0.0/24 dns-server '10.0.0.1'
set service dhcp-server shared-network-name LAN subnet 10.0.0.0/24 domain-name 'home.dmarby.se dhcp.home.dmarby.se'
set service dhcp-server shared-network-name LAN subnet 10.0.0.0/24 lease '600'
set service dhcp-server shared-network-name LAN subnet 10.0.0.0/24 start 10.0.0.30 stop '10.0.0.254'

set service dhcp-server shared-network-name LAN subnet 10.0.0.0/24 static-mapping 'plex' ip-address '10.0.0.15'
set service dhcp-server shared-network-name LAN subnet 10.0.0.0/24 static-mapping 'plex' mac-address '00:50:56:a7:62:a6'

set service dhcp-server shared-network-name LAN subnet 10.0.0.0/24 static-mapping 'unifi' ip-address '10.0.0.17'
set service dhcp-server shared-network-name LAN subnet 10.0.0.0/24 static-mapping 'unifi' mac-address '00:50:56:a7:40:a0'

set firewall name WAN-LAN default-action 'drop'
set firewall name WAN-LAN rule 1 action 'accept'
set firewall name WAN-LAN rule 1 state established 'enable'
set firewall name WAN-LAN rule 1 state related 'enable'

set firewall name WAN-LAN rule 5 action 'accept'
set firewall name WAN-LAN rule 5 destination address '10.0.0.15'
set firewall name WAN-LAN rule 5 destination port '32400'
set firewall name WAN-LAN rule 5 protocol 'tcp'
set firewall name WAN-LAN rule 5 state new 'enable'

set firewall name WAN-LAN rule 6 action 'accept'
set firewall name WAN-LAN rule 6 destination address '10.0.0.17'
set firewall name WAN-LAN rule 6 destination port '8080'
set firewall name WAN-LAN rule 6 protocol 'tcp'
set firewall name WAN-LAN rule 6 state new 'enable'

set firewall name WAN-LAN rule 7 action 'accept'
set firewall name WAN-LAN rule 7 destination address '10.0.0.17'
set firewall name WAN-LAN rule 7 destination port '3478'
set firewall name WAN-LAN rule 7 protocol 'udp'
set firewall name WAN-LAN rule 7 state new 'enable'

set nat destination rule 4 description 'Port Forward: Plex'
set nat destination rule 4 destination port '14945'
set nat destination rule 4 inbound-interface 'eth1'
set nat destination rule 4 protocol 'tcp'
set nat destination rule 4 translation address '10.0.0.15'
set nat destination rule 4 translation port '32400'

set nat destination rule 5 description 'Port Forward: Unifi Controller'
set nat destination rule 5 destination port '8080'
set nat destination rule 5 inbound-interface 'eth1'
set nat destination rule 5 protocol 'tcp'
set nat destination rule 5 translation address '10.0.0.17'

set nat destination rule 6 description 'Port Forward: Unifi Controller STUN'
set nat destination rule 6 destination port '3478'
set nat destination rule 6 inbound-interface 'eth1'
set nat destination rule 6 protocol 'udp'
set nat destination rule 6 translation address '10.0.0.17'

set firewall name WAN-LOCAL default-action 'drop'
set firewall name WAN-LOCAL rule 10 action 'accept'
set firewall name WAN-LOCAL rule 10 state established 'enable'
set firewall name WAN-LOCAL rule 10 state related 'enable'

set firewall name WAN-LOCAL rule 11 action 'accept'
set firewall name WAN-LOCAL rule 11 destination port '1194'
set firewall name WAN-LOCAL rule 11 protocol 'udp'

set interfaces ethernet eth1 firewall in name 'WAN-LAN'
set interfaces ethernet eth1 firewall local name 'WAN-LOCAL'

set system package repository lithium components 'main'
set system package repository lithium distribution 'current'
set system package repository lithium url 'http://dev.packages.vyos.net/vyos/'

set system package repository jessie components 'main contrib non-free'
set system package repository jessie distribution 'jessie'
set system package repository jessie url 'http://httpredir.debian.org/debian/'

set system package repository jessie-security components 'main contrib non-free'
set system package repository jessie-security distribution 'jessie/updates'
set system package repository jessie-security url 'http://httpredir.debian.org//debian-security/'

set system name-server '127.0.0.1'
set system name-server '8.8.8.8'

set system task-scheduler task dynamic_dns interval 5m
set system task-scheduler task dynamic_dns executable path /config/scripts/dynamic_dns.sh

delete interfaces ethernet eth1 disable

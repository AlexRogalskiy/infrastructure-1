set interfaces openvpn vtun0 mode 'server'
set interfaces openvpn vtun0 server subnet '{{ vpn_ip_range }}'
set interfaces openvpn vtun0 tls ca-cert-file '/config/auth/openvpn/ca.crt'
set interfaces openvpn vtun0 tls cert-file '/config/auth/openvpn/server.crt'
set interfaces openvpn vtun0 tls dh-file '/config/auth/openvpn/dh.pem'
set interfaces openvpn vtun0 tls key-file '/config/auth/openvpn/server.key'
set interfaces openvpn vtun0 server domain-name '{{ vpn_hostname }}'
set interfaces openvpn vtun0 server name-server '{{ vpn_local_dns }}'
set interfaces openvpn vtun0 server push-route '{{ vpn_ip_range_local }}'
set interfaces openvpn vtun0 openvpn-option '--tls-auth /config/auth/openvpn/ta.key'
set interfaces openvpn vtun0 openvpn-option '--client-cert-not-required'
set interfaces openvpn vtun0 openvpn-option '--username-as-common-name'
set interfaces openvpn vtun0 openvpn-option '--keepalive 10 120'
set interfaces openvpn vtun0 openvpn-option '--plugin /opt/go/src/github.com/DMarby/duo-openvpn-standalone/intermediary/intermediary.so /opt/go/src/github.com/DMarby/duo-openvpn-standalone/duo-openvpn-standalone.so'
set interfaces openvpn vtun0 openvpn-option '--duplicate-cn'
set interfaces openvpn vtun0 openvpn-option '--persist-key'
set interfaces openvpn vtun0 openvpn-option '--persist-tun'
set interfaces openvpn vtun0 openvpn-option '--tls-version-min 1.2'
set interfaces openvpn vtun0 openvpn-option '--cipher AES-256-CBC'
set interfaces openvpn vtun0 openvpn-option '--auth SHA256'
set interfaces openvpn vtun0 openvpn-option '--verb 3'
set interfaces openvpn vtun0 openvpn-option '--keysize 256'
set interfaces openvpn vtun0 openvpn-option '--comp-lzo'
set interfaces openvpn vtun0 openvpn-option '--reneg-sec 0'

set nat source rule 200 outbound-interface 'eth1'
set nat source rule 200 source address '{{ vpn_ip_range }}'
set nat source rule 200 translation address masquerade

set system login user vyos authentication public-keys {{ lookup('file', ssh_public_key_path).split(' ')[2] }} type {{ lookup('file', ssh_public_key_path).split(' ')[0] }}
set system login user vyos authentication public-keys {{ lookup('file', ssh_public_key_path).split(' ')[2] }} key {{ lookup('file', ssh_public_key_path).split(' ')[1] }}
set service ssh port '22'
set service ssh disable-password-authentication
set interfaces ethernet eth1 address dhcp
set interfaces ethernet eth1 description 'WAN'
delete interfaces ethernet eth0 address dhcp
set interfaces ethernet eth0 address '10.0.0.1/24'
set interfaces ethernet eth0 description 'LAN'
set nat source rule 100 outbound-interface 'eth1'
set nat source rule 100 source address '10.0.0.1/24'
set nat source rule 100 translation address masquerade
set service dhcp-server disabled 'false'
set service dhcp-server shared-network-name LAN subnet 10.0.0.0/24 default-router '10.0.0.1'
set service dhcp-server shared-network-name LAN subnet 10.0.0.0/24 dns-server '10.0.0.1'
set service dhcp-server shared-network-name LAN subnet 10.0.0.0/24 domain-name 'home.dmarby.se'
set service dhcp-server shared-network-name LAN subnet 10.0.0.0/24 lease '86400'
set service dhcp-server shared-network-name LAN subnet 10.0.0.0/24 start 10.0.0.30 stop '10.0.0.254'
set service dns forwarding cache-size '0'
set service dns forwarding listen-on 'eth0'
set service dns forwarding name-server '8.8.8.8'
set service dns forwarding name-server '8.8.4.4'
set firewall name WAN-LAN default-action 'drop'
set firewall name WAN-LAN rule 10 action 'accept'
set firewall name WAN-LAN rule 10 state established 'enable'
set firewall name WAN-LAN rule 10 state related 'enable'
set firewall name WAN-LOCAL default-action 'drop'
set firewall name WAN-LOCAL rule 10 action 'accept'
set firewall name WAN-LOCAL rule 10 state established 'enable'
set firewall name WAN-LOCAL rule 10 state related 'enable'
set interfaces ethernet eth1 firewall in name 'WAN-LAN'
set interfaces ethernet eth1 firewall local name 'WAN-LOCAL'

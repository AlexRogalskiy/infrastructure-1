{
  "variables": {
    "iso_path": "http://dev.packages.vyos.net/iso/current/amd64/vyos-999.201707291034-amd64.iso",
    "iso_checksum_value": "8b46ecdc33c9450c3655eb6a14e35524ee509dd6",
    "vcenter_datacenter": "",
    "vcenter_datastore": "",
    "vcenter_host": "",
    "vcenter_password": "",
    "vcenter_username": "",
    "packer_vsphere_datastore": "",
    "packer_vsphere_host": "",
    "packer_vsphere_password": "",
    "packer_vsphere_username": ""
  },
  "builders": [
    {
      "name": "vyos",
      "type": "vmware-iso",
      "guest_os_type": "debian8-64",
      "tools_upload_flavor": "linux",
      "headless": true,

      "ssh_port": 22,
      "ssh_timeout": "15m",
      "ssh_username": "vyos",
      "ssh_password": "vyos",
      "ssh_wait_timeout": "30m",

      "vnc_disable_password": true,

      "disk_type_id": "thin",
      "disk_size": "4096",

      "boot_wait": "30s",

      "iso_url": "{{user `iso_path`}}",
      "iso_checksum": "{{user `iso_checksum_value`}}",
      "iso_checksum_type": "sha1",

      "boot_command": [
        "<enter><wait10><wait10><wait10>",
        "vyos<enter><wait>",
        "vyos<enter><wait>",
        "install image<enter><wait>",
        "<enter><wait>",
        "<enter><wait>",
        "<enter><wait>",
        "Yes<enter><wait>",
        "<enter><wait10>",
        "<wait10>",
        "<wait10>",
        "<wait10>",
        "<wait10>",
        "<wait10>",
        "<enter><wait10>",
        "<wait10>",
        "<wait10>",
        "<wait10>",
        "<wait10>",
        "<wait10>",
        "<wait10>",
        "<wait10>",
        "<enter><wait10>",
        "<wait10>",
        "<wait10>",
        "<wait10>",
        "<wait10>",
        "<wait10>",
        "<wait10>",
        "<wait10>",
        "vyos<enter><wait>",
        "vyos<enter><wait>",
        "<enter><wait10>",
        "<wait10>",
        "<wait10>",
        "<wait10>",
        "<wait10>",
        "<wait10>",
        "sudo sed -i 's/reboot -d -f -i/eject -m cdrom\\n\\treboot -d -f -i/' /etc/init.d/reboot<enter><wait>",
        "reboot<enter><wait>",
        "Yes<enter><wait10>",
        "<wait10>",
        "<wait10>",
        "<wait10>",
        "<wait10>",
        "vyos<enter><wait>",
        "vyos<enter><wait>",
        "configure<enter><wait>",
        "set interface ethernet eth0 address dhcp<enter><wait>",
        "set service ssh<enter><wait>",
        "commit<enter><wait>",
        "save<enter><wait>",
        "exit<enter><wait>",
        "reboot<enter><wait>",
        "Yes<enter><wait10>",
        "<wait10>",
        "<wait10>",
        "<wait10>",
        "<wait10>"
      ],

      "remote_type": "esx5",
      "remote_host": "{{user `packer_vsphere_host`}}",
      "remote_datastore": "{{user `packer_vsphere_datastore`}}",
      "remote_username": "{{user `packer_vsphere_username`}}",
      "remote_password": "{{user `packer_vsphere_password`}}",

      "vmx_data": {
        "memsize": "2048",
        "numvcpus": "4",

        "ethernet0.networkName": "VM Network"
      },

      "format": "ovf",
      "ovftool_options": ["--noImageFiles"],
      "vmx_remove_ethernet_interfaces": true
    }
  ],
  "provisioners": [
    {
      "scripts": [
        "packer/vyos/scripts/base.sh",
        "packer/vyos/scripts/cleanup.sh"
      ],
      "type": "shell",
      "skip_clean": true
    }
  ],
  "post-processors": [
    {
      "type": "vsphere-template",

      "host": "{{user `vcenter_host`}}",
      "username": "{{user `vcenter_username`}}",
      "password": "{{user `vcenter_password`}}",

      "datacenter": "{{user `vcenter_datacenter`}}",
      "datastore": "{{user `vcenter_datastore`}}",

      "os_type": "other26xLinux64Guest",
      "os_id": "1",

      "vm_name": "{{ build_name }}-template"
    }
  ]
}
